<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ôn tập IP (Routing - ICMP - IP)</title>
    <style>
        /* --- GIỮ NGUYÊN CSS CŨ CỦA BẠN --- */
        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --success: #22c55e;
            --error: #ef4444;
            --bg: #f1f5f9;
            --card-bg: #ffffff;
            --text: #334155;
            --selected-bg: #eff6ff;
            --selected-border: #2563eb;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .container {
            background-color: var(--card-bg);
            border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            width: 100%;
            max-width: 800px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .header {
            background-color: var(--primary);
            color: white;
            padding: 1.5rem 2rem;
        }

        .header h1 { margin: 0; font-size: 1.5rem; }
        
        .progress-bar {
            height: 6px;
            background-color: rgba(255,255,255,0.3);
            margin-top: 1rem;
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: #fbbf24;
            width: 0%;
            transition: width 0.3s ease;
        }

        .quiz-body { padding: 2rem; }

        .question-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: #64748b;
            margin-bottom: 0.5rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .question-text {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            line-height: 1.5;
        }

        .question-image-container {
            text-align: center;
            margin-bottom: 1.5rem;
            display: none; 
        }

        .question-image-container img {
            max-width: 100%;
            max-height: 300px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .options-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option-item {
            display: flex;
            align-items: flex-start;
            background-color: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .option-item:hover:not(.disabled) {
            background-color: #f8fafc;
            border-color: var(--primary);
        }

        .option-item.selected {
            border-color: var(--selected-border);
            background-color: var(--selected-bg);
        }

        .indicator {
            width: 20px;
            height: 20px;
            border: 2px solid #cbd5e1;
            margin-right: 15px;
            margin-top: 2px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-shrink: 0;
            background: white;
        }

        .type-single .indicator { border-radius: 50%; }
        .type-single .option-item.selected .indicator {
            border-color: var(--primary);
            background-color: var(--primary);
            box-shadow: inset 0 0 0 4px white;
        }

        .type-multi .indicator { border-radius: 4px; }
        .type-multi .option-item.selected .indicator {
            border-color: var(--primary);
            background-color: var(--primary);
            color: white;
        }
        .type-multi .option-item.selected .indicator::after {
            content: '✓'; font-size: 14px; font-weight: bold;
        }

        .option-item.correct {
            background-color: #dcfce7 !important;
            border-color: var(--success) !important;
            color: #15803d !important;
        }
        .option-item.wrong {
            background-color: #fee2e2 !important;
            border-color: var(--error) !important;
            color: #b91c1c !important;
        }
        .option-item.missed {
            border-color: var(--success) !important;
            border-style: dashed;
            background-color: #f0fdf4 !important;
        }
        
        .option-item.disabled { pointer-events: none; opacity: 0.9; }

        .explanation {
            margin-top: 1.5rem;
            padding: 1rem;
            background-color: #eff6ff;
            border-left: 4px solid var(--primary);
            border-radius: 4px;
            display: none;
            animation: fadeIn 0.5s;
        }

        .controls {
            padding: 1.5rem 2rem;
            border-top: 1px solid #e2e8f0;
            display: flex;
            justify-content: flex-end;
            background-color: #f8fafc;
        }

        .btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 12px 28px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }
        .btn:hover { background-color: var(--primary-dark); }
        .btn:disabled { background-color: #94a3b8; cursor: not-allowed; }

        .hide { display: none !important; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .score-container { text-align: center; padding: 3rem; }
        .score-circle {
            width: 120px; height: 120px; border-radius: 50%;
            background: var(--primary); color: white;
            display: flex; justify-content: center; align-items: center;
            font-size: 2.5rem; font-weight: bold; margin: 0 auto 1.5rem;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header" id="header">
        <h1>Bài tập IP</h1>
        <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>
    </div>

    <div class="quiz-body" id="quiz-area">
        <div class="question-meta">
            <span id="q-number">Câu hỏi 1</span>
            <span id="q-type" style="color: var(--primary)">Chọn 1 đáp án</span>
        </div>
        
        <div class="question-text" id="q-text">Loading...</div>
        
        <div class="question-image-container" id="q-img-container">
            <img id="q-img" src="" alt="Hình minh họa">
        </div>

        <div class="options-grid" id="options-grid"></div>
        <div class="explanation" id="explanation"></div>
    </div>

    <div class="score-container hide" id="score-area">
        <div class="score-circle" id="final-score">0</div>
        <h2>Hoàn thành bài thi!</h2>
        <p id="score-msg">...</p>
        <button class="btn" id="restart-btn">Làm lại</button>
    </div>

    <div class="controls" id="controls">
        <button class="btn" id="submit-btn" disabled>Kiểm tra</button>
        <button class="btn hide" id="next-btn">Câu tiếp theo</button>
    </div>
</div>

<script>
    // --- DỮ LIỆU CÂU HỎI ---
    const quizData = [

    /* ================= STATIC ROUTING ================= */

    {
        question: "Hệ thống mạng giả lập có kiến trúc và các địa chỉ IP như hình vẽ. Để ping được từ máy A đến máy X, mức độ tối thiểu cần thêm vào các bảng routing trên từng router như thế nào?",
        hasImage: true,
        imgSrc: "images/1.1.jpg",
        options: [
            "Thêm vào bảng routing của R1 đường đi đến mạng 192.168.1.0",
            "Thêm vào bảng routing của R1 đường đi đến mạng 192.168.2.0",
            "Thêm vào bảng routing của R1 đường đi đến mạng 192.168.3.0",
            "Thêm vào bảng routing của R2 đường đi đến mạng 192.168.1.0",
            "Thêm vào bảng routing của R2 đường đi đến mạng 192.168.2.0",
            "Thêm vào bảng routing của R2 đường đi đến mạng 192.168.3.0",
            "Thêm vào bảng routing của R3 đường đi đến mạng 192.168.1.0",
            "Thêm vào bảng routing của R3 đường đi đến mạng 192.168.2.0",
            "Thêm vào bảng routing của R3 đường đi đến mạng 192.168.3.0"
        ],
        correct: [2, 5, 6],
        note: "Cần đảm bảo router biết đường đến mạng đích và đường quay về mạng nguồn."
    },

    {
        question: "Để các trạm A và B kết nối được Internet thì bắt buộc cần cấu hình R1 là default gateway của mạng 192.168.1.0/24.",
        hasImage: true,
        imgSrc: "images/1.1.jpg",
        options: ["Đúng", "Sai"],
        correct: 1,
        note: "Không bắt buộc, các router trung gian có thể định tuyến bằng route cụ thể."
    },


    {
        question: "Thiết lập default gateway cho các trạm và các router trong hệ thống như thế nào là đúng?",
        hasImage: true,
        imgSrc: "images/1.1.jpg",
        options: [
            "Máy A và B có default gateway là R1",
            "Router R2 có default gateway là R1",
            "Router R3 có default gateway là R1",
            "Máy X có default gateway là R1"
        ],
        correct: [0, 1],
        note: "Máy X và R3 sử dụng route cụ thể, không cần default gateway."
    },

    {
        question: "Xét bảng routing của router R1. Những nhận định nào sau đây là đúng?",
        hasImage: true,
        imgSrc: "images/1.1.jpg",
        options: [
            "Bảng routing của R1 có prefix LAN1 (192.168.1.0/24) với next hop là R1",
            "Bảng routing của R1 có prefix mạng NAT (10.0.2.0/24) với next hop là máy host",
            "Bảng routing của R1 có prefix LAN2 (192.168.2.0/24) với next hop là R2",
            "Bảng routing của R1 có prefix LAN3 (192.168.3.0/24) với next hop là R3",
            "Bảng routing của R1 có prefix LAN3 (192.168.3.0/24) với next hop là R2"
        ],
        correct: [2, 4],
        note: "R1 đi đến LAN3 thông qua R2."
    },

    {
        question: "Triển khai tracepath trong môi trường thực hành. Những nhận định nào sau đây là đúng?",
        hasImage: true,
        imgSrc: "images/1.2.jpg",
        options: [
            "Máy A chạy tracepath đến Google thì hop đầu tiên là default gateway của máy A",
            "Máy X chạy tracepath đến Google thì hop đầu tiên là router R1",
            "Máy A chạy tracepath đến máy X thì hop đầu tiên là router R1",
            "Máy A chạy tracepath đến máy X thì hop đầu tiên là router R2"
        ],
        correct: [0, 2],
        note: "Hop đầu tiên luôn là gateway trực tiếp của máy gửi."
    },

    /* ================= ICMP ================= */

    {
        question: "Xét sơ đồ ICMP Redirect sau. Những nhận định nào sau đây là đúng?",
        hasImage: true,
        imgSrc: "images/1.2.jpg",
        options: [
            "Quá trình routing vòng vẫn tiếp diễn nhưng gói tin vẫn gửi đến đích",
            "Gói tin trả lời từ Network X về Host đi qua G2 rồi vòng qua G1",
            "Máy Host gửi gói tin đến Network X phải chuyển tiếp qua G1 vì G1 là default gateway",
            "G1 xác định next hop là G2 vì nó được khai báo trong bảng routing của G1"
        ],
        correct: [0, 2, 3],
        note: "ICMP Redirect chỉ tối ưu đường đi cho host."
    },

    {
        question: "Trong thông báo ICMP Redirect, giá trị a.b.c.d là 10.0.0.1.",
        hasImage: true,
        imgSrc: "images/1.2.jpg",
        options: ["Đúng", "Sai"],
        correct: 1,
        note: "a.b.c.d là địa chỉ gateway tốt hơn (G2)."
    },

    {
        question: "Gói tin số 1 trong hình vẽ là ICMP Echo Request có địa chỉ nguồn là 10.0.0.100 và đích là 203.162.0.11.",
        hasImage: true,
        imgSrc: "images/1.2.jpg",
        options: ["Đúng", "Sai"],
        correct: 0
    },

    {
        question: "Các địa chỉ IP và dữ liệu trong gói tin số 4 và gói tin số 1 là giống nhau.",
        hasImage: true,
        imgSrc: "images/1.2.jpg",
        options: ["Đúng", "Sai"],
        correct: 0
    },

    {
        question: "Gói tin ICMP Echo Reply không được thể hiện trên hình vẽ.",
        hasImage: true,
        imgSrc: "images/1.2.jpg",
        options: ["Đúng", "Sai"],
        correct: 0
    },

    {
        question: "ICMP Redirect thông báo đang có hiện tượng routing đi vòng. Để loại bỏ tình huống này, cần thêm mộtgateway nữa vào routing table của máy Host.",
        hasImage: true,
        imgSrc: "images/1.2.jpg",
        options: ["Đúng", "Sai"],
        imgSrc: "images/1.2.jpg",
        correct: 0
    },

    /* ================= IP CƠ BẢN ================= */

    {
        question: "Tên đầy đủ của địa chỉ IP là gì?",
        options: [
            "Internet Provider address",
            "Internet Processing address",
            "Internet Protocol address",
            "None of the above"
        ],
        correct: 2
    },

    {
        question: "Địa chỉ mạng (net ID) của một máy tính có địa chỉ IP 192.168.242.5/20 là gì?",
        options: [
            "192.168.242.2",
            "192.168.240.5",
            "192.168.240.0",
            "192.168.241.1"
        ],
        correct: 2
    },

    {
        question: "Cú pháp /28 trong địa chỉ IP nói lên điều gì?",
        options: [
            "Số lượng bit trong phần host ID",
            "Số lượng máy trạm trong mạng",
            "Số lượng bit trong phần network ID",
            "Không có đáp án nào đúng"
        ],
        correct: 2
    },

    {
        question: "Unicast là một phương pháp truyền tin.",
        options: ["Đúng", "Sai"],
        correct: 0
    },

    {
        question: "Địa chỉ broadcast của một network có máy trạm 192.168.242.5/20 là gì?",
        options: [
            "192.168.250.250",
            "192.168.251.251",
            "192.168.255.255",
            "192.168.250.251"
        ],
        correct: 2
    },

    {
        question: "Mạng có network mask 255.255.240.0 thì chứa bao nhiêu máy trạm?",
        options: [
            "100",
            "256",
            "4094",
            "192.168.250.252"
        ],
        correct: 2
    },

    {
        question: "Hai địa chỉ IP 152.16.168.196/28 và 162.16.168.30 có nằm trong cùng một mạng không?",
        options: ["Yes", "No"],
        correct: 1
    },

    /* ================= CLASSLESS ROUTING ================= */

    {
        question: "Thực hiện ping từ H1 đến H2, R1 kiểm tra thấy có thể sử dụng những luật nào trong routing table đểchuyển tiếp gói tin",
        hasImage: true,
        imgSrc: "images/1.3.jpg",
        options: [
            "192.168.0.0/16 >> R2",
            "192.168.128.0/24 >> R2",
            "192.168.128.100/25 >> R2",
            "192.168.128.200/25 >> R2",
            "192.168.128.64/26 >> R2"
        ],
        correct: [0, 1, 2, 4],
        note: "Nguyên tắc longest prefix match."
    },

    {
        question: "Thực hiện ping từ H1 đến H2, R1 sử dụng luật nào trong routing table để chuyển tiếp gói tin?",
        hasImage: true,
        imgSrc: "images/1.3.jpg",
        options: [
            "192.168.0.0/16 >> R2",
            "192.168.128.0/24 >> R2",
            "192.168.128.100/25 >> R2",
            "192.168.128.200/25 >> R2",
            "192.168.128.64/26 >> R2"
        ],
        correct: 4,
        note: "Luật có prefix dài nhất được ưu tiên."
    },

    {
        question: "Chạy ping từ H1 đến H2, bắt các gói tin IP trên kênh truyền từ R1 đến R2, những nhận định sau cái nào đúng",
        hasImage: true,
        imgSrc: "images/1.4.jpg",
        options: [
            "Gói tin IP có địa chỉ nguồn là 192.169.1.100 và đích là 192.168.1.10",
            "Gói tin IP có địa chỉ mạng nguồn là 192.169.1.0/24 và mạng đích là 192.168.1.0/24",
            "Gói tin IP có địa chỉ mạng nguồn là 192.169.1.0/24 và mạng đích là 192.168.1.0/25",
            "Gói tin IP chứa thông tin netmask /25 để báo cho router cách lấy địa chỉ mạng"
        ],
        correct: 0,
        note: "Netmask không được mang theo trong gói IP."
    },

    {
        question: "Để tối ưu bảng routing tại R2, 2 luật trên có thể được gộp bằng 1 luật \"gộp\". Những luật nào sau đây có thể sử dụng làm luật \"gộp\"?",
        hasImage: true,
        imgSrc: "images/1.3.jpg",
        options: [
            "192.168.0.0/16 >> R3",
            "192.168.128.0/24 >> R3",
            "192.168.128.100/25 >> R3",
            "192.168.128.200/25 >> R3"
        ],
        correct: [1, 0],
        note: "Hai dải /25 liên tiếp gộp thành /24."
    },

    {
        question: "Nhận định nào sau đây là đúng?",
        hasImage: true,
        imgSrc: "images/1.4.jpg",
        options: [
            "R1 và R2 cùng vận hành routing theo cơ chế classful",
            "R1 và R2 cùng vận hành routing theo cơ chế classless",
            "R1 chạy classful routing, R2 chạy classless routing",
            "R1 chạy classless routing, R2 chạy classful routing"
        ],
        correct: 1,
        note: "Hệ thống sử dụng VLSM nên là classless."
    },

    /* ================= RIP – CƠ BẢN ================= */

    {
        question: "Sử dụng môi trường giả lập mạng, bắt gói tin ICMP giữa các router trong quá trình phát hiện router láng giềng sử dụng giao thức RIPv2. Những nhận định nào sau đây là đúng?",
        options: [
            "ICMP được gửi unicast giữa các router khi trả lời trực tiếp đến một router",
            "ICMP được gửi đến địa chỉ 224.0.0.9 khi router muốn tìm kiếm router láng giềng",
            "ICMP được gửi broadcast giữa các router khi router muốn quảng bá sự có mặt của mình",
            "ICMP được gửi multicast giữa các router khi router muốn tìm kiếm router láng giềng"
        ],
        correct: [0, 1, 3],
        note: "RIPv2 sử dụng multicast 224.0.0.9, không dùng broadcast."
    },

    {
        question: "Khi một kết nối mạng giữa hai router RIP bị đứt, các router sẽ loan báo và cập nhật bảng routing như thế nào?",
        options: [
            "Router tự động phát hiện và cập nhật bảng routing tức thời",
            "Quản trị mạng phải cấu hình lại router để thông báo lỗi",
            "Router tự động (sau một khoảng thời gian định kỳ) lan truyền cập nhật bảng routing và cập nhật tình trạng kết nối lỗi",
            "Router luôn lan truyền bảng routing định kỳ kể cả khi không có lỗi"
        ],
        correct: [2, 3],
        note: "RIP cập nhật định kỳ và hội tụ sau một khoảng thời gian."
    },

    /* ================= RIP – METRIC & RTE ================= */

    {
        question: "Xét sơ đồ mạng Rx–R1–R2–R3 (có hình ảnh). Router Rx thấy có hai RTE với metric lần lượt là 4 và 5. Những nhận định nào sau đây là đúng khi các router trao đổi RTE từ router láng giềng?",
        hasImage: true,
        imgSrc: "images/2.1.jpg",
        options: [
            "R1 nhận từ R1: (prefix #1, metric: 3)",
            "R1 nhận từ R2: (prefix #1, metric: 0)",
            "R1 nhận từ R3: (prefix #2, metric: 0)",
            "R1 nhận từ R2: (prefix #2, metric: 1)",
            "Rx nhận (prefix #1, metric: 3)",
            "Rx nhận (prefix #2, metric: 4)"  
        ],
        correct: [1, 3, 4, 5],
        note: "RIP là distance vector, metric là số hop."
    },

    {
        question: "Trong giao thức RIP, quá trình router xác định router láng giềng thì gói tin nào được sử dụng?",
        options: [
            "RIP Hello",
            "ICMP Hello",
            "ICMP Solicitation",
            "ICMP Advertisement"
        ],
        correct: [2, 3],
        note: "RIP sử dụng message dạng request/response (advertisement)."
    },

    {
        question: "Mục tiêu của giao thức RIP là giúp router xác định tất cả các đường đi và tính khoảng cách đến mạng đích. Nhận định này đúng hay sai?",
        options: ["Đúng", "Sai"],
        correct: 0,
        note: "RIP không tìm tất cả đường đi, chỉ tìm đường đi tốt nhất dựa trên metric."
    },


    /* ================= RIP – SUY LUẬN SỐ ROUTER ================= */

    {
        question: "Xét hệ thống backbone R1–R–…–R2–R3 (có hình ảnh). Dựa vào metric tại các router, số lượng router R nằm giữa R1 và R2 là bao nhiêu?",
        hasImage: true,
        imgSrc: "images/2.2.jpg",
        options: ["6", "7", "8", "9"],
        correct: 2,
        note: "Hiệu metric phản ánh số router trung gian."
    },

    {
        question: "Xét hệ thống mạng có nhiều nhánh (có hình ảnh). Dựa trên metric trong data-plane, số router R nằm giữa R1 và R2 là bao nhiêu?",
        hasImage: true,
        imgSrc: "images/2.3.jpg",
        options: ["2", "3", "4", "5"],
        correct: 1
    },

    /* ================= RIP – CẤU HÌNH ================= */

    {
        question: "Trong cấu hình RIP, khai báo network có những tác dụng gì?",
        options: [
            "Thông báo cho các router khác về một network trong hệ thống",
            "Kết nối router vào network này",
            "Kích hoạt (enable) kết nối mạng này để quảng bá bằng RIP",
            "Tìm kiếm router láng giềng trên local link ứng với network"
        ],
        correct: [2, 3],
        note: "Lệnh network dùng để enable RIP trên interface."
    },

    /* ================= CONTROL PLANE vs DATA PLANE ================= */

    {
        question: "So sánh routing protocol và routed protocol: routing protocol dùng cho Control Plane, routed protocol dùng cho Data Plane. Nhận định này đúng hay sai?",
        options: ["Đúng", "Sai"],
        correct: 0
    },

    /* ================= RIP – MESSAGE & METRIC ================= */

    {
        question: "Xét các RIP message trong hệ thống (có hình ảnh). Giá trị metric '???' trong message RIP số 2 mà R1 nhận được là bao nhiêu?",
        hasImage: true,
        imgSrc: "images/2.4.jpg",
        options: ["2", "3", "4", "5"],
        correct: 1,
        note: "Metric được cộng thêm 1 khi truyền từ router láng giềng."
    },

    /* ================= RIP – DISTANCE VECTOR ================= */

    {
        question: "Giao thức RIP được gọi là distance vector vì router tính đường đi bằng thuật toán Dijkstra.",
        options: ["Đúng", "Sai"],
        correct: 1,
        note: "RIP dùng Bellman-Ford, không phải Dijkstra."
    },

    /* ================= RIP – CONTROL PLANE → DATA PLANE ================= */

    {
        question: "Trong giao thức RIP, router đưa một RTE từ Control Plane sang Data Plane vào thời điểm nào?",
        options: [
            "Mỗi khi router nhận được gói tin RIP",
            "Mỗi khi router nhận được gói tin IP",
            "Khi giá trị metric được cập nhật trong Control Plane",
            "Khi giá trị metric được cập nhật trong Data Plane"
        ],
        correct: 2,
        note: "Control Plane tính toán xong mới cập nhật Data Plane."
    },

    {
        question: "Trong giao thức RIP, khi nhận được yêu cầu tìm kiếm router láng giềng, router trả lời bằng gói tin nào?",
        options: [
            "RIP Reply",
            "ICMP Reply",
            "ICMP Advertisement",
            "ICMP Solicitation"
        ],
        correct: 2
    },

    /* ================= OSPF HELLO ================= */

    {
        question: "Router láng giềng của router 192.168.1.1 có địa chỉ IP là gì?",
        hasImage: true,
        imgSrc: "images/3.1.jpg",
        options: [
            "192.168.1.1",
            "192.168.1.2",
            "224.0.0.5",
            "2.2.2.2"
        ],
        correct: 1
    },

    {
        question: "Router láng giềng của router 192.168.1.1 có Router-ID là gì?",
        hasImage: true,
        imgSrc: "images/3.1.jpg",
        options: [
            "1.1.1.1",
            "2.2.2.2",
            "192.168.1.1",
            "192.168.1.2"
        ],
        correct: 1
    },

    {
        question: "Các router láng giềng trao đổi với nhau bằng phương pháp multicast theo địa chỉ:",
        hasImage: true,
        imgSrc: "images/3.1.jpg",
        options: [
            "224.0.0.1",
            "224.0.0.2",
            "224.0.0.5",
            "224.0.0.6"
        ],
        correct: 2
    },

    {
        question: "Để giám sát trạng thái kết nối giữa hai router OSPF trong cùng mạng broadcast, hệ thống sẽ có những LSA nào?",
        hasImage: true,
        imgSrc: "images/3.1.jpg",
        options: [
            "1 router-LSA",
            "2 router-LSA",
            "1 network-LSA",
            "2 network-LSA"
        ],
        correct: [1, 2],
        note: "Mỗi router sinh một router-LSA."
    },

    /* ================= OSPF DATABASE ================= */

    {
        question: "Hệ thống có bao nhiêu router?",
        hasImage: true,
        imgSrc: "images/3.2.jpg",
        options: ["2", "3", "4", "5"],
        correct: 2
    },

    {
        question: "Hệ thống có bao nhiêu mạng nghiệp vụ (business network)?",
        hasImage: true,
        imgSrc: "images/3.2.jpg",
        options: ["1", "2", "3", "4"],
        correct: 3
    },

    {
        question: "Dựa vào OSPF database của router (có hình ảnh), các router kết nối với nhau theo mô hình nào?",
        hasImage: true,
        imgSrc: "images/3.2.jpg",
        options: [
            "Kết nối đôi một (point-to-point)",
            "Tất cả router cùng nối vào một đường trục",
            "Kết nối vòng",
            "Không đủ thông tin để xác định"
        ],
        correct: 1
    },

    /* ================= OSPF – CƠ BẢN ================= */

    {
        question: "Mô hình OSPF single area giải quyết được nhược điểm cơ bản của mô hình RIP là các việc xác định đường đi tối ưu cho gói tin sẽ được cập nhật theo trạng thái đường truyền. Các gói tin không bị dồn theo một đường đi cố định dẫn đến nghẽn kết nối trong khi đường đi khác đang \"thông thoáng\".",
        options: ["Đúng", "Sai"],
        correct: 0
    },

    {
        question: "RIP sử dụng phương pháp định tuyến dựa trên khoảng cách (distance vector) trong khi OSPF sử dụng phương pháp định tuyến dựa trên trạng thái đường truyền (link state). Cả hai giao thức định tuyến này cùng hướng đến mục tiêu tự động xây dựng bảng routing dựa trên cơ chế router tự động xác định láng giềng bằng ICMP và lan tỏa các thông điệp RIP hoặc OSPF",
        options: ["Đúng", "Sai"],
        correct: 1,
        note: "OSPF không dùng ICMP để tìm láng giềng."
    },

    {
        question: "Địa chỉ IP nào được các router OSPF sử dụng để trao đổi LSA",
        options: [
            "224.0.0.1",
            "224.0.0.5",
            "224.0.0.2",
            "224.0.1.5"
        ],
        correct: 1
    },

    /* ================= OSPF – CƠ CHẾ ================= */

    {
        question: "Hãy chọn nhận định đúng về giao thức OSPF.",
        options: [
            "OSPF sử dụng TCP để truyền dữ liệu",
            "OSPF sử dụng UDP để truyền dữ liệu",
            "OSPF sử dụng protocol number 89 và chạy trực tiếp trên IP",
            "Không có câu nào đúng"
        ],
        correct: 3
    },

    {
        question: "Giá trị nào (hoặc những giá trị nào) quyết định đến kết quả quá trình lựa chọn Designated Router tronggiao thức OSPF Hello??",
        options: [
            "IP Address",
            "Router ID",
            "Priority",
            "Code version"
        ],
        correct: [1, 2],
        note: "Ưu tiên DR dựa trên Priority, sau đó là Router-ID."
    },

    {
        question: "Giá trị cost của Link State tăng lên khi tốc độ đường truyền tăng lên. Nhận định này đúng hay sai?",
        options: ["Đúng", "Sai"],
        correct: 1,
        note: "Tốc độ càng cao thì cost càng thấp."
    },

    {
        question: "Để thiết lập cost của kết nối mạng trong cấu hình OSPF, trong môi trường thực hành, khai báo nào trong cấu hình interface của router cho phép thiết lập cost=1563?",
        options: [
            "bandwidth 64",
            "ospf cost 1563",
            "bandwidth 56",
            "bandwidth 64k",
            "bandwidth 56k"
        ],
        correct: [0, 1]
    },

    /* ================= OSPF – LSA LAN TRUYỀN ================= */

    {
        question: "Các LSA lan tỏa trong area bao gồm?",
        hasImage: true,
        imgSrc: "images/3.3.jpg",
        options: [
            "4 router-LSA",
            "8 router-LSA",
            "12 router-LSA",
            "1 network-LSA",
            "4 network-LSA",
            "8 network-LSA"
        ],
        correct: [0, 4]
    },

    {
        question: "Trong cùng hệ thống trên, khi đường kết nối R3–R4 bị giảm tốc độ còn 50%, các LSA nào được lan truyền?",
        hasImage: true,
        imgSrc: "images/3.3.jpg",
        options: [
            "1 router-LSA",
            "2 router-LSA",
            "1 network-LSA",
            "2 network-LSA"
        ],
        correct: 0,
        note: "Chỉ router có thay đổi trạng thái link sinh router-LSA mới."
    },

    {
        question: "Khi R4 gặp sự cố và các link từ R4 đến R1, R3 bị giảm tốc độ (chiều ngược lại không ảnh hưởng), các LSA nào được lan truyền?",
        hasImage: true,
        imgSrc: "images/3.3.jpg",
        options: [
            "1 router-LSA",
            "2 router-LSA",
            "1 network-LSA",
            "2 network-LSA"
        ],
        correct: 0
    },

    /* ================= OSPF – BACKBONE ================= */

    {
        question: "Các router quảng bá OSPF cho tất cả mạng trực tiếp. Các LSA được quảng bá trong hệ thống là?",
        hasImage: true,
        imgSrc: "images/3.4.jpg",
        options: [
            "1 router-LSA",
            "4 router-LSA",
            "1 network-LSA",
            "4 network-LSA"
        ],
        correct: [1, 2]
    },

    /* ================= OSPF – CẤU TRÚC GÓI TIN ================= */

    {
        question: "Trong hệ thống OSPF, router sử dụng thành phần nào trong gói tin OSPF để trao đổi thông tin trạng thái kết nối?",
        options: [
            "OSPF header",
            "OSPF advertisement",
            "Router Link State Advertisement",
            "Network Link State Advertisement",
            "Single Area Advertisement"
        ],
        correct: [2, 3]
    },    

    /* ================= PHẦN 1: OSPF MULTI AREA ================= */

    {
        question: "Trong các LSA sau đây, LSA nào có thể chứa thông tin trạng thái kết nối mạng?",
        options: [
            "router-LSA",
            "network-LSA",
            "summary-LSA",
            "external-LSA"
        ],
        correct: [0, 2, 3],
        note: "Router-LSA và Network-LSA mô tả trạng thái link trong area."
    },

    {
        question: "Trong mô hình OSPF multi area, LSA nào được lan truyền để cập nhật giá (cost) của đường đi từ một đỉnh đến nút lá của đồ thị?",
        options: [
            "router-LSA",
            "network-LSA",
            "summary-LSA",
            "external-LSA"
        ],
        correct: 2,
        note: "Summary-LSA mang thông tin cost từ area khác."
    },

    {
        question: "Trong hệ thống OSPF multi area, các router luôn cập nhật đầy đủ hình trạng mạng và trạng thái các kết nối mạng vào LS Database để xây dựng bản đồ đầy đủ của toàn hệ thống. Nhận định này đúng hay sai?",
        options: ["Đúng", "Sai"],
        correct: 1,
        note: "Router chỉ có full topology trong area của mình."
    },

    {
        question: "Biết rằng router R thuộc Area 0 đang thiết lập đường đi đến prefix N là 150 khi đi qua ABR1 và 160 khi đi qua ABR2. Area 1 có thay đổi trạng thái mạng, router-LSA và network-LSA được lan truyền trong vùng #1 đến 2 router ABR và kích hoạt summary-LSA từ 2 ABR này đến router R với thông số lần lượt là ARB1: (prefix_N, sum_N = 55) và ARB2:(prefix_N, sum_N = 65). Biết rằng cost đường đi từ R đến ABR1 là 100 và đến ABR2 là 80. Hãy cập nhật cost từ router R đến prefix N theo trạng thái mới của mạng",
        hasImage: true,
        imgSrc: "images/4.1.jpg",
        options: ["140", "145", "150", "155"],
        correct: 1,
        note: "Cost mới = cost R→ABR1 (100) + summary cost (55) = 145."
    },

    {
        question: "Trong các LSA sau đây, LSA nào chứa thông tin cho phép xây dựng đồ thị mô phỏng kết nối liên mạng (không quan tâm đến cost)?",
        options: [
            "router-LSA",
            "network-LSA",
            "summary-LSA",
            "external-LSA"
        ],
        correct: 1,
        note: "Router-LSA và Network-LSA mô tả topology."
    },

    {
        question: "Cho biết trong data plane của router R đang lưu trữ cost ngắn nhất đến prefix N là 125. Area #2 xuất hiện thay đổi trạng thái mạng, router-LSA được lan truyền trong Area #2 và kích hoạt summary-LSA tại ABR để lan truyền đến router R với thông số (prefix_N, sum_N = 35). Biết rằng cost hiện tại trong data plane từ R đến ABR là 100. R sẽ cập nhật cost mới đến prefix N với giá trị bao nhiêu?",
        hasImage: true,
        imgSrc: "images/4.2.jpg",
        options: ["125", "130", "135", "140"],
        correct: 2,
        note: "Cost mới = cost R→ABR (100) + summary cost (35) = 135."
    },

    {
        question: "Lựa chọn các nhận định đúng.",
        hasImage: true,
        imgSrc: "images/4.3.jpg",
        options: [
            "ABR là router R2",
            "R4 nhận được router-LSA từ R1",
            "Bảng routing của R4 không có prefix thuộc Area 1",
            "R5 nhận được summary-LSA từ R2",
            "R1 và R4 nhận được cùng một summary-LSA từ R2"
        ],
        correct: [0, 3],
        note: "Router chỉ học summary-LSA cho area khác."
    },

    {
        question: "khi khởi tạo hệ thống, ABR quảng bá bao nhiêu summary-LSA vào Area 0?",
        hasImage: true,
        imgSrc: "images/4.4.jpg",
        options: ["1", "2", "3", "4"],
        correct: 2,
        note: "Mỗi network trong area 1 tạo một summary-LSA."
    },

    {
        question: "Khi trạng thái của net3 thay đổi, số summary-LSA được ABR quảng bá vào Area 0 là bao nhiêu?",
        hasImage: true,
        imgSrc: "images/4.4.jpg",
        options: ["1", "2", "3"],
        correct: 0,
        note: "Chỉ network bị thay đổi sinh summary-LSA mới."
    },

    {
        question: "Khi tốc độ kết nối của net2 tăng dần đều, số summary-LSA được quảng bá là bao nhiêu?",
        hasImage: true,
        imgSrc: "images/4.4.jpg",
        options: ["1", "2", "3"],
        correct: 1,
        note: "Thay đổi cost làm phát sinh cập nhật summary-LSA."
    },

    {
        question: "Khi tốc độ kết nối của net2 giảm dần đều, số summary-LSA được quảng bá là bao nhiêu?",
        hasImage: true,
        imgSrc: "images/4.4.jpg",
        options: ["1", "2", "3"],
        correct: 0
    },

    {
        question: "Số lượng Summary-LSA được quảng bá trong Area 0 là bao nhiêu?",
        hasImage: true,
        imgSrc: "images/4.5.jpg",
        options: ["1", "2", "3", "4"],
        correct: 1,
        note: "ABR quảng bá summary-LSA theo số network liên vùng."
    },

    {
        question: "Số lượng Summary-LSA được quảng bá trong Area 1 là bao nhiêu?",
        hasImage: true,
        imgSrc: "images/4.5.jpg",
        options: ["1", "2", "3", "4"],
        correct: 1,
        note: "ABR quảng bá summary-LSA theo số network liên vùng."
    },

    {
        question: "Khi router nhận được một Summary-LSA và cập nhật vào LS Database, router có thực hiện thuật toán SPF cho các prefix ở xa (area khác) hay không?",
        options: ["Có thực hiện", "Không thực hiện"],
        correct: 1,
        note: "SPF chỉ chạy đầy đủ trong area nội bộ."
    },

    /* ================= PHẦN 2: OSPF EXTERNAL ================= */

    {
        question: "khai báo redistribute static trên R1 có những tác dụng gì?",
        hasImage: true,
        imgSrc: "images/4.6.jpg",
        options: [
            "Lan truyền External-LSA 192.168.56.0 vào OSPF",
            "Lan truyền External-LSA 172.21.0.0 vào OSPF",
            "lan truyền summary-LSA vào mạng 172.21.0.0",
            "thiết lập đường đi đến prefix 192.168.56.0 trong bảng routing của R2: next hop là R1",
            "thiết lập đường đi đến prefix 172.21.0.0/16 trong bảng routing của R2: next hop là R1"
        ],
        correct: [1, 4],
        note: "Static route được đưa vào OSPF dưới dạng External-LSA."
    },

    {
        question: "Khi kết nối OSPF với một hệ thống bên ngoài, router R đóng vai trò là ASBR kết nối trực tiếp với router bên ngoài là Rx. Rx quảng bá 2 prefix Net1 và Net2 đến ASBR và ASBR kích hoạt external-LSA để lan truyền thông tin các prefix này vào trong hệ thống OSPF. Xem bảng routing của các router R1, R2, R3 bên trong hệ thống OSPF, đối với prefix Net1 và Net2, next hope luôn luôn là router ASBR. Nhận định này đúng hay sai?",
        hasImage: true,
        imgSrc: "images/4.7.jpg",
        options: ["Đúng", "Sai"],
        correct: 1,
        note: "External-LSA chỉ định ASBR là điểm ra."
    },

    {
        question: "Khai báo redistribute rip trong OSPF có những tác dụng gì?",
        hasImage: true,
        imgSrc: "images/4.8.jpg",
        options: [
            "khai báo hệ thống OSPF được kết nối với một hệ thống ngoài (external) mà hệ thống ngoài này đang sử dụng RIP",
            "khai báo hệ thống RIP được kết nối với một hệ thống ngoài (external) mà hệ thống ngoài này đang sử dụng OSPF",
            "lan truyền 1 external-LSA 172.x.0.0/16",
            "lan truyền 2 external-LSA 172.x.0.0/16",
            "lan truyền 1 external-LSA 192.168.x.0/24",
            "lan truyền 2 external-LSA 192.168.x.0/24",
            "lan truyền 3 external-LSA 192.168.x.0/24"
        ],
        correct: [0, 6],
        note: "Redistribute chỉ theo một chiều cấu hình."
    },

    {
        question: "R1 kết nối với Internet qua NAT Gateway và khai báo redistribute connected . Nhận định sau đây đúng hay sai?",
        hasImage: true,
        imgSrc: "images/4.9.jpg",
        options: [
            "Khai báo redistribute connected làm thay đổi bảng routing của R1",
            "Khai báo redistribute connected không làm thay đổi bảng routing của R1"
        ],
        correct: 1,
        note: "Redistribute connected không thay đổi routing local."
    },

    {
        question: "dòng Destination nào được thêm vào bảng routing của R2?",
        hasImage: true,
        imgSrc: "images/4.10.jpg",
        options: [
            "10.0.2.0",
            "172.16.100.0",
            "192.168.1.0",
            "0.0.0.0"
        ],
        correct: 0
    },

    {
        question: "Khai báo redistribute connected trên R1 tạo ra bao nhiêu External-LSA?",
        hasImage: true,
        imgSrc: "images/4.10.jpg",
        options: ["0", "1", "2", "3"],
        correct: 1
    },

    {
        question: "khai báo redistribute connected trên R1 có tác dụng gì?",
        hasImage: true,
        imgSrc: "images/4.10.jpg",
        options: [
            "Lan truyền External-LSA 10.0.2.0 vào OSPF",
            "lan truyền các LSA lên kết nối mạng 10.0.2.0 của R1",
            "thiết lập đường đi đến prefix 10.0.2.0 trong bảng routing của R2 và R3: next hop là R1",
            "thiết lập default gateway của R2 và R3 là R1"
        ],
        correct: [0, 2],
        note: "Không tự động thiết lập default gateway cho router khác."
    },

    {
        question: "Với khai báo redistribute connected trên R1 cùng với kết quả các bảng routing được tạo ra trên R1 và R2 như các câu trên. Nhận định sau đây đúng hay sai?",
        hasImage: true,
        imgSrc: "images/4.10.jpg",
        options: [
            "R1 kết nối thành công ra Internet (check bằng lệnh ping 8.8.8.8 ) thì R2 cũng kết nối thành công",
            "R1 kết nối thành công ra Internet (check bằng lệnh ping 8.8.8.8 ) nhưng R2 không kết nối thành công"
        ],
        correct: 1
    },

    /* ================= PHẦN 3: TỐI ƯU OSPF ================= */

    {
        question: "Từ khóa nào dùng để khai báo một area là totally stub?",
        options: [
            "totally stub",
            "stub totally",
            "no-summary",
            "summarize"
        ],
        correct: 2,
        note: "Totally stub = stub + no-summary."
    },

    {
        question: "Cú pháp cấu hình area 3 là totally stub trong Quagga/FRR là gì?",
        options: [
            "area 3 no-summary",
            "area 3 stub",
            "area 3 stub summary",
            "area 3 stub no-summary"
        ],
        correct: 3
    },

    {
        question: "Các area stub được sử dụng trong OSPF với mục đích gì?",
        options: [
            "Giảm thời gian LSA flooding",
            "Giảm kích thước LS Database",
            "Giảm kích thước routing table",
            "Tất cả các ý trên"
        ],
        correct: 3
    },

    {
        question: "Trong OSPF Stub Area, những loại LSA nào được lan truyền?",
        options: [
            "Type 1",
            "Type 2",
            "Type 3",
            "Type 4",
            "Type 7"
        ],
        correct: [0, 1, 2],
        note: "Stub area không nhận external-LSA."
    },

    {
        question: "Cú pháp cấu hình area 10 là Stub trong Quagga/FRR là gì?",
        options: [
            "router ospf id 1",
            "area 10 stub",
            "area 10 stub enable",
            "router ospf 1"
        ],
        correct: 1
    },

    /* ================= KIẾN TRÚC BGP ================= */

    {
        question: "Nhận định sau đúng hay sai? Trong kiến trúc kết nối BGP, các router láng giềng eBGP kết nối trực tiếp, còn các router iBGP có thể kết nối không trực tiếp.",
        options: ["Đúng", "Sai"],
        correct: 0,
        note: "eBGP yêu cầu kết nối trực tiếp, iBGP có thể không trực tiếp nhưng phải full-mesh hoặc dùng RR."
    },

    {
        question: "Khi lựa chọn đường đi theo quy tắc policy, ưu tiên nào được các router BGP áp dụng theo mặc định?",
        options: [
            "AS path, local preference, multi-exit discriminator",
            "Multi-exit discriminator, AS path, local preference",
            "Local preference, AS path, multi-exit discriminator",
            "AS path, multi-exit discriminator, local preference",
            "Tất cả đều sai"
        ],
        correct: 2,
        note: "Thứ tự ưu tiên mặc định: Local Preference → AS Path → MED."
    },

    /* ================= PHÂN TÍCH BẢNG BGP ================= */

    {
        question: "Next hop cho prefix 172.16.0.0/16 trong routing table là gì?",
        hasImage: true,
        imgSrc: "images/5.1.jpg",
        options: [
            "11.0.0.0",
            "192.168.1.2",
            "192.168.4.2",
            "10.0.0.0",
            "Không xác định được"
        ],
        correct: 1,
        note: "Next hop được lấy từ tuyến BGP được chọn đưa xuống routing table."
    },

    {
        question: "Tương tự như RIP, quá trình loan báo thông tin một prefix bằng các thông điệp BGP cho phép xác định đường định tuyến đến network này qua các AS bằng cách đi ngược lại đường loan báo thông điệp BGP. Như vậy có thể khẳng định đường routing từ một router đến một prefix chính là bằng đường đi qua các router BGP ngược theo thứ tự thông điệp BGP đã đi qua?",
        options: ["Đúng", "Sai"],
        correct: 1,
        note: "BGP không suy ra đường đi vật lý, chỉ dựa trên AS-PATH."
    },

    /* ================= XỬ LÝ iBGP / eBGP ================= */

    {
        question: "Khi nhận được một thông điệp iBGP chứa thông tin một prefix, router BGP thực hiện các hoạt động nào sau đây?",
        options: [
            "Ghi nhận nội dung và quảng bá prefix này đến router láng giềng tiếp theo",
            "Cập nhật AS path cho prefix vừa nhận",
            "Kích hoạt thông tin prefix vừa nhận vào hệ thống IGP của AS",
            "Không làm gì"
        ],
        correct: 0,
        note: "iBGP không sửa AS-PATH, chỉ lan truyền theo quy tắc iBGP."
    },

    {
        question: "Thông tin nào giúp một router BGP quyết định loan báo thông điệp BGP đến router láng giềng bằng iBGP hay eBGP?",
        options: [
            "Dựa vào địa chỉ IP láng giềng",
            "Dựa vào số hiệu cổng kết nối",
            "Dựa vào AS number khi khai báo router BGP láng giềng",
            "Dựa vào kết nối IGP giữa các router"
        ],
        correct: 2,
        note: "So sánh AS number để phân biệt iBGP hay eBGP."
    },

    /* ================= REDISTRIBUTE & EXPORT ================= */

    {
        question: "Bảng routing của một router BGP có thể được tính toán lại và cập nhật trong các trường hợp nào?",
        options: [
            "Nhận được bản ghi iBGP",
            "Nhận được bản ghi eBGP",
            "Nhận được bản ghi IGP",
            "Tất cả các trường hợp trên"
        ],
        correct: [1, 2],
        note: "Mọi thay đổi đầu vào control plane đều có thể kích hoạt tính toán lại."
    },

    {
        question: "Quá trình phát hiện và kết nối láng giềng của các router BGP được thực hiện như thế nào?",
        options: [
            "Admin phải khai báo địa chỉ IP của từng router láng giềng",
            "Bằng giao thức ICMP",
            "Bằng giao thức BGP",
            "Không có phương án nào đúng"
        ],
        correct: 0,
        note: "BGP không tự discovery, phải cấu hình thủ công neighbor."
    },

    {
        question: "Các router BGP sẽ loan báo thông tin prefix nào?",
        hasImage: true,
        imgSrc: "images/5.2.jpg",
        options: [
            "10.0.0.0/8",
            "11.0.0.0/8",
            "172.16.0.0/24",
            "192.168.3.0/24",
            "192.168.41.0/24",
            "192.168.42.0/24"
        ],
        correct: [2, 3, 4],
        note: "Chỉ prefix được export hoặc redistribute phù hợp mới được quảng bá."
    },

    {
        question: "Trong cấu hình BGP với redistribute OSPF (có hình ảnh), các router BGP sẽ loan báo thông tin prefix nào?",
        hasImage: true,
        imgSrc: "images/5.3.jpg",
        options: [
            "10.0.0.0/8",
            "11.0.0.0/8",
            "172.16.0.0/24",
            "192.168.3.0/24",
            "192.168.41.0/24",
            "192.168.42.0/24"
        ],
        correct: [2, 5],
        note: "Chỉ prefix học từ OSPF được redistribute."
    },

    /* ================= BGP & INTERNET ================= */

    {
        question: "Trong kết nối backbone Internet với BGP, ISP cấp block 221.30.48.0–221.30.63.255 và cấp lại cho My backbone block 221.30.48.0–221.30.50.255. Những prefix nào được quảng bá lên BGP?",
        hasImage: true,
        imgSrc: "images/5.4.jpg",
        options: [
            "3 block /24",
            "1 block /23 và 1 block /24",
            "1 block /22",
            "1 block /20",
            "1 block /19",
            "Không có đáp án đúng"
        ],
        correct: [1, 3],
        note: "221.30.48.0–50.255 = /23 + /24."
    },

    /* ================= REDISTRIBUTE STATIC ================= */

    {
        question: "các router BGP sẽ loan báo thông tin prefix nào?",
        hasImage: true,
        imgSrc: "images/5.5.jpg",
        options: [
            "10.0.0.0/8",
            "11.0.0.0/8",
            "172.16.0.0/24",
            "192.168.3.0/24",
            "192.168.41.0/24",
            "192.168.42.0/24"
        ],
        correct: [1, 2],
        note: "Static route được redistribute vào BGP."
    },

    {
        question: "Dữ liệu BGP table như sau (có hình ảnh). Next hop của prefix 172.16.0.0/16 trong routing table là gì?",
        hasImage: true,
        imgSrc: "images/5.6.jpg",
        options: [
            "10.0.0.0",
            "192.168.1.2",
            "192.168.4.2",
            "11.0.0.0",
            "Không xác định được"
        ],
        correct: 2,
        note: "Next hop lấy theo bản ghi BGP được chọn."
    },

    /* ================= XỬ LÝ eBGP ================= */

    {
        question: "Khi nhận được một bản ghi eBGP, router sẽ thực hiện những công việc nào sau đây?",
        options: [
            "Cập nhật AS Path",
            "Chuyển tiếp thông tin cho router BGP láng giềng",
            "Lan truyền thông tin prefix từ BGP vào nội bộ AS bằng IGP",
            "Tính toán đường đi theo distance vector hoặc Dijkstra"
        ],
        correct: [0, 1, 2],
        note: "BGP không dùng Dijkstra hay distance vector."
    },

    /* ================= QUY MÔ ROUTING ================= */

    {
        question: "Một router R kết nối Internet backbone (89000 prefix) qua 2 ISP, peering thêm 9000 prefix, và có 5000 prefix nội bộ OSPF. Số route trong control plane của R là bao nhiêu?",
        hasImage: true,
        imgSrc: "images/5.7.jpg",
        options: ["178000", "187000", "192000", "103000"],
        correct: 2,
        note: "89000×2 + 9000 + 5000 = 192000."
    },

    {
        question: "Dữ liệu các đường đi từ control plan trong router R được lựa chọn và quyết định đưa xuống data plan. Hãy tính số đường đi trong data plan (routing table) của R?",
        hasImage: true,
        imgSrc: "images/5.7.jpg",
        options: ["192000", "178000", "103000", "89000"],
        correct: 2,
        note: "Chỉ giữ best path: 89000 + 9000 + 5000 = 103000."
    }
    ];

    let currentQ = 0;
    let score = 0;
    let selectedAnswers = null; 

    const qNum = document.getElementById('q-number');
    const qType = document.getElementById('q-type');
    const qText = document.getElementById('q-text');
    const imgContainer = document.getElementById('q-img-container');
    const imgEl = document.getElementById('q-img');
    const optionsGrid = document.getElementById('options-grid');
    const explanationEl = document.getElementById('explanation');
    const submitBtn = document.getElementById('submit-btn');
    const nextBtn = document.getElementById('next-btn');
    const progressFill = document.getElementById('progress-fill');
    const restartBtn = document.getElementById('restart-btn');

    // --- 1. HÀM XÁO TRỘN CÂU HỎI (MỚI) ---
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    // --- 2. HÀM KHỞI TẠO BÀI THI (MỚI) ---
    function initQuiz() {
        shuffleArray(quizData); // Đảo câu hỏi
        currentQ = 0;
        score = 0;
        
        // Reset giao diện
        document.getElementById('quiz-area').classList.remove('hide');
        document.getElementById('controls').classList.remove('hide');
        document.getElementById('header').classList.remove('hide');
        document.getElementById('score-area').classList.add('hide');

        loadQuestion();
    }

    function loadQuestion() {
        const q = quizData[currentQ];
        const isMulti = Array.isArray(q.correct);

        qNum.innerText = `Câu hỏi ${currentQ + 1} / ${quizData.length}`;
        qType.innerText = isMulti ? '(Chọn nhiều đáp án)' : '(Chọn 1 đáp án)';
        qType.style.color = isMulti ? '#e11d48' : '#2563eb';

        qText.innerText = q.question;
        explanationEl.style.display = 'none';
        
        // Xử lý hình ảnh
        if (q.hasImage) {
            imgContainer.style.display = 'block';
            if (q.imgSrc) {
                imgEl.src = q.imgSrc;
            } else {
                imgEl.src = "https://via.placeholder.com/600x300?text=Chua+co+hinh+anh";
            }
        } else {
            imgContainer.style.display = 'none';
        }

        optionsGrid.innerHTML = '';
        optionsGrid.className = 'options-grid ' + (isMulti ? 'type-multi' : 'type-single');
        
        selectedAnswers = isMulti ? [] : null;
        submitBtn.disabled = true;
        submitBtn.classList.remove('hide');
        nextBtn.classList.add('hide');

        q.options.forEach((opt, idx) => {
            const el = document.createElement('div');
            el.className = 'option-item';
            el.innerHTML = `<div class="indicator"></div><div>${opt}</div>`;
            el.onclick = () => handleSelect(el, idx, isMulti);
            optionsGrid.appendChild(el);
        });

        updateProgress();
    }

    function handleSelect(el, idx, isMulti) {
        if (el.classList.contains('disabled')) return;

        if (isMulti) {
            el.classList.toggle('selected');
            const pos = selectedAnswers.indexOf(idx);
            if (pos === -1) selectedAnswers.push(idx);
            else selectedAnswers.splice(pos, 1);
            selectedAnswers.sort((a, b) => a - b);
            submitBtn.disabled = selectedAnswers.length === 0;
        } else {
            const all = optionsGrid.children;
            for (let child of all) child.classList.remove('selected');
            el.classList.add('selected');
            selectedAnswers = idx;
            submitBtn.disabled = false;
        }
    }

    submitBtn.onclick = () => {
        const q = quizData[currentQ];
        const isMulti = Array.isArray(q.correct);
        const allOpts = optionsGrid.children;
        let isCorrect = false;

        for (let child of allOpts) child.classList.add('disabled');

        if (isMulti) {
            const sortedCorrect = [...q.correct].sort((a, b) => a - b);
            const sortedSelected = [...selectedAnswers].sort((a, b) => a - b);
            isCorrect = JSON.stringify(sortedCorrect) === JSON.stringify(sortedSelected);

            for (let i = 0; i < allOpts.length; i++) {
                if (q.correct.includes(i)) {
                    if (selectedAnswers.includes(i)) allOpts[i].classList.add('correct');
                    else allOpts[i].classList.add('missed');
                } else {
                    if (selectedAnswers.includes(i)) allOpts[i].classList.add('wrong');
                }
            }
        } else {
            isCorrect = (selectedAnswers === q.correct);
            if (isCorrect) {
                allOpts[selectedAnswers].classList.add('correct');
            } else {
                allOpts[selectedAnswers].classList.add('wrong');
                allOpts[q.correct].classList.add('correct');
            }
        }

        if (isCorrect) score++;

        if (q.note) {
            explanationEl.innerHTML = `<strong>Giải thích:</strong> ${q.note}`;
            explanationEl.style.display = 'block';
        }

        submitBtn.classList.add('hide');
        nextBtn.classList.remove('hide');
    };

    nextBtn.onclick = () => {
        currentQ++;
        if (currentQ < quizData.length) loadQuestion();
        else showResult();
    };

    function updateProgress() {
        const pct = (currentQ / quizData.length) * 100;
        progressFill.style.width = `${pct}%`;
    }

    function showResult() {
        document.getElementById('quiz-area').classList.add('hide');
        document.getElementById('controls').classList.add('hide');
        document.getElementById('header').classList.add('hide');
        document.getElementById('score-area').classList.remove('hide');
        
        const finalScoreEl = document.getElementById('final-score');
        finalScoreEl.innerText = `${score}/${quizData.length}`;
        
        const pct = (score / quizData.length) * 100;
        const circle = document.querySelector('.score-circle');
        circle.style.background = `conic-gradient(var(--success) ${pct}%, #e2e8f0 0)`;

        const msg = document.getElementById('score-msg');
        if (pct >= 80) msg.innerText = "Xuất sắc! Bạn nắm rất vững kiến thức.";
        else if (pct >= 50) msg.innerText = "Khá tốt! Hãy ôn lại các câu sai nhé.";
        else msg.innerText = "Cần cố gắng thêm!";
    }

    // --- 3. GÁN SỰ KIỆN CHO NÚT LÀM LẠI ---
    restartBtn.onclick = () => {
        initQuiz();
    };

    // --- BẮT ĐẦU ---
    initQuiz(); // Thay vì gọi loadQuestion(), ta gọi initQuiz()
</script>

</body>
</html>