<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ôn tập IP (Routing - ICMP - IP)</title>
    <style>
        /* --- GIỮ NGUYÊN CSS CŨ CỦA BẠN --- */
        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --success: #22c55e;
            --error: #ef4444;
            --bg: #f1f5f9;
            --card-bg: #ffffff;
            --text: #334155;
            --selected-bg: #eff6ff;
            --selected-border: #2563eb;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .container {
            background-color: var(--card-bg);
            border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            width: 100%;
            max-width: 800px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .header {
            background-color: var(--primary);
            color: white;
            padding: 1.5rem 2rem;
        }

        .header h1 { margin: 0; font-size: 1.5rem; }
        
        .progress-bar {
            height: 6px;
            background-color: rgba(255,255,255,0.3);
            margin-top: 1rem;
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: #fbbf24;
            width: 0%;
            transition: width 0.3s ease;
        }

        .quiz-body { padding: 2rem; }

        .question-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: #64748b;
            margin-bottom: 0.5rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .question-text {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            line-height: 1.5;
        }

        .question-image-container {
            text-align: center;
            margin-bottom: 1.5rem;
            display: none; 
        }

        .question-image-container img {
            max-width: 100%;
            max-height: 300px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .options-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option-item {
            display: flex;
            align-items: flex-start;
            background-color: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .option-item:hover:not(.disabled) {
            background-color: #f8fafc;
            border-color: var(--primary);
        }

        .option-item.selected {
            border-color: var(--selected-border);
            background-color: var(--selected-bg);
        }

        .indicator {
            width: 20px;
            height: 20px;
            border: 2px solid #cbd5e1;
            margin-right: 15px;
            margin-top: 2px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-shrink: 0;
            background: white;
        }

        .type-single .indicator { border-radius: 50%; }
        .type-single .option-item.selected .indicator {
            border-color: var(--primary);
            background-color: var(--primary);
            box-shadow: inset 0 0 0 4px white;
        }

        .type-multi .indicator { border-radius: 4px; }
        .type-multi .option-item.selected .indicator {
            border-color: var(--primary);
            background-color: var(--primary);
            color: white;
        }
        .type-multi .option-item.selected .indicator::after {
            content: '✓'; font-size: 14px; font-weight: bold;
        }

        .option-item.correct {
            background-color: #dcfce7 !important;
            border-color: var(--success) !important;
            color: #15803d !important;
        }
        .option-item.wrong {
            background-color: #fee2e2 !important;
            border-color: var(--error) !important;
            color: #b91c1c !important;
        }
        .option-item.missed {
            border-color: var(--success) !important;
            border-style: dashed;
            background-color: #f0fdf4 !important;
        }
        
        .option-item.disabled { pointer-events: none; opacity: 0.9; }

        .explanation {
            margin-top: 1.5rem;
            padding: 1rem;
            background-color: #eff6ff;
            border-left: 4px solid var(--primary);
            border-radius: 4px;
            display: none;
            animation: fadeIn 0.5s;
        }

        .controls {
            padding: 1.5rem 2rem;
            border-top: 1px solid #e2e8f0;
            display: flex;
            justify-content: flex-end;
            background-color: #f8fafc;
        }

        .btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 12px 28px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }
        .btn:hover { background-color: var(--primary-dark); }
        .btn:disabled { background-color: #94a3b8; cursor: not-allowed; }

        .hide { display: none !important; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .score-container { text-align: center; padding: 3rem; }
        .score-circle {
            width: 120px; height: 120px; border-radius: 50%;
            background: var(--primary); color: white;
            display: flex; justify-content: center; align-items: center;
            font-size: 2.5rem; font-weight: bold; margin: 0 auto 1.5rem;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header" id="header">
        <h1>Bài tập IP</h1>
        <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>
    </div>

    <div class="quiz-body" id="quiz-area">
        <div class="question-meta">
            <span id="q-number">Câu hỏi 1</span>
            <span id="q-type" style="color: var(--primary)">Chọn 1 đáp án</span>
        </div>
        
        <div class="question-text" id="q-text">Loading...</div>
        
        <div class="question-image-container" id="q-img-container">
            <img id="q-img" src="" alt="Hình minh họa">
        </div>

        <div class="options-grid" id="options-grid"></div>
        <div class="explanation" id="explanation"></div>
    </div>

    <div class="score-container hide" id="score-area">
        <div class="score-circle" id="final-score">0</div>
        <h2>Hoàn thành bài thi!</h2>
        <p id="score-msg">...</p>
        <button class="btn" id="restart-btn">Làm lại</button>
    </div>

    <div class="controls" id="controls">
        <button class="btn" id="submit-btn" disabled>Kiểm tra</button>
        <button class="btn hide" id="next-btn">Câu tiếp theo</button>
    </div>
</div>

<script>
    // --- DỮ LIỆU CÂU HỎI ---
const quizData = [

/* ================= OSPF HELLO ================= */

{
    question: "Router láng giềng của router 192.168.1.1 có địa chỉ IP là gì?",
    hasImage: true,
    imgSrc: "images/3.1.jpg",
    options: [
        "192.168.1.1",
        "192.168.1.2",
        "224.0.0.5",
        "2.2.2.2"
    ],
    correct: 1
},

{
    question: "Router láng giềng của router 192.168.1.1 có Router-ID là gì?",
    hasImage: true,
    imgSrc: "images/3.1.jpg",
    options: [
        "1.1.1.1",
        "2.2.2.2",
        "192.168.1.1",
        "192.168.1.2"
    ],
    correct: 1
},

{
    question: "Các router láng giềng trao đổi với nhau bằng phương pháp multicast theo địa chỉ:",
    hasImage: true,
    imgSrc: "images/3.1.jpg",
    options: [
        "224.0.0.1",
        "224.0.0.2",
        "224.0.0.5",
        "224.0.0.6"
    ],
    correct: 2
},

{
    question: "Để giám sát trạng thái kết nối giữa hai router OSPF trong cùng mạng broadcast, hệ thống sẽ có những LSA nào?",
    hasImage: true,
    imgSrc: "images/3.1.jpg",
    options: [
        "1 router-LSA",
        "2 router-LSA",
        "1 network-LSA",
        "2 network-LSA"
    ],
    correct: [1, 2],
    note: "Mỗi router sinh một router-LSA."
},

/* ================= OSPF DATABASE ================= */

{
    question: "Hệ thống có bao nhiêu router?",
    hasImage: true,
    imgSrc: "images/3.2.jpg",
    options: ["2", "3", "4", "5"],
    correct: 2
},

{
    question: "Hệ thống có bao nhiêu mạng nghiệp vụ (business network)?",
    hasImage: true,
    imgSrc: "images/3.2.jpg",
    options: ["1", "2", "3", "4"],
    correct: 3
},

{
    question: "Dựa vào OSPF database của router (có hình ảnh), các router kết nối với nhau theo mô hình nào?",
    hasImage: true,
    imgSrc: "images/3.2.jpg",
    options: [
        "Kết nối đôi một (point-to-point)",
        "Tất cả router cùng nối vào một đường trục",
        "Kết nối vòng",
        "Không đủ thông tin để xác định"
    ],
    correct: 1
},

/* ================= OSPF – CƠ BẢN ================= */

{
    question: "Mô hình OSPF single area giải quyết được nhược điểm cơ bản của mô hình RIP là các việc xác định đường đi tối ưu cho gói tin sẽ được cập nhật theo trạng thái đường truyền. Các gói tin không bị dồn theo một đường đi cố định dẫn đến nghẽn kết nối trong khi đường đi khác đang \"thông thoáng\".",
    options: ["Đúng", "Sai"],
    correct: 0
},

{
    question: "RIP sử dụng phương pháp định tuyến dựa trên khoảng cách (distance vector) trong khi OSPF sử dụng phương pháp định tuyến dựa trên trạng thái đường truyền (link state). Cả hai giao thức định tuyến này cùng hướng đến mục tiêu tự động xây dựng bảng routing dựa trên cơ chế router tự động xác định láng giềng bằng ICMP và lan tỏa các thông điệp RIP hoặc OSPF",
    options: ["Đúng", "Sai"],
    correct: 1,
    note: "OSPF không dùng ICMP để tìm láng giềng."
},

{
    question: "Địa chỉ IP nào được các router OSPF sử dụng để trao đổi LSA",
    options: [
        "224.0.0.1",
        "224.0.0.5",
        "224.0.0.2",
        "224.0.1.5"
    ],
    correct: 1
},

/* ================= OSPF – CƠ CHẾ ================= */

{
    question: "Hãy chọn nhận định đúng về giao thức OSPF.",
    options: [
        "OSPF sử dụng TCP để truyền dữ liệu",
        "OSPF sử dụng UDP để truyền dữ liệu",
        "OSPF sử dụng protocol number 89 và chạy trực tiếp trên IP",
        "Không có câu nào đúng"
    ],
    correct: 3
},

{
    question: "Giá trị nào (hoặc những giá trị nào) quyết định đến kết quả quá trình lựa chọn Designated Router tronggiao thức OSPF Hello??",
    options: [
        "IP Address",
        "Router ID",
        "Priority",
        "Code version"
    ],
    correct: [1, 2],
    note: "Ưu tiên DR dựa trên Priority, sau đó là Router-ID."
},

{
    question: "Giá trị cost của Link State tăng lên khi tốc độ đường truyền tăng lên. Nhận định này đúng hay sai?",
    options: ["Đúng", "Sai"],
    correct: 1,
    note: "Tốc độ càng cao thì cost càng thấp."
},

{
    question: "Để thiết lập cost của kết nối mạng trong cấu hình OSPF, trong môi trường thực hành, khai báo nào trong cấu hình interface của router cho phép thiết lập cost=1563?",
    options: [
        "bandwidth 64",
        "ospf cost 1563",
        "bandwidth 56",
        "bandwidth 64k",
        "bandwidth 56k"
    ],
    correct: [0, 1]
},

/* ================= OSPF – LSA LAN TRUYỀN ================= */

{
    question: "Các LSA lan tỏa trong area bao gồm?",
    hasImage: true,
    imgSrc: "images/3.3.jpg",
    options: [
        "4 router-LSA",
        "8 router-LSA",
        "12 router-LSA",
        "1 network-LSA",
        "4 network-LSA",
        "8 network-LSA"
    ],
    correct: [0, 4]
},

{
    question: "Trong cùng hệ thống trên, khi đường kết nối R3–R4 bị giảm tốc độ còn 50%, các LSA nào được lan truyền?",
    hasImage: true,
    imgSrc: "images/3.3.jpg",
    options: [
        "1 router-LSA",
        "2 router-LSA",
        "1 network-LSA",
        "2 network-LSA"
    ],
    correct: 0,
    note: "Chỉ router có thay đổi trạng thái link sinh router-LSA mới."
},

{
    question: "Khi R4 gặp sự cố và các link từ R4 đến R1, R3 bị giảm tốc độ (chiều ngược lại không ảnh hưởng), các LSA nào được lan truyền?",
    hasImage: true,
    imgSrc: "images/3.3.jpg",
    options: [
        "1 router-LSA",
        "2 router-LSA",
        "1 network-LSA",
        "2 network-LSA"
    ],
    correct: 0
},

/* ================= OSPF – BACKBONE ================= */

{
    question: "Các router quảng bá OSPF cho tất cả mạng trực tiếp. Các LSA được quảng bá trong hệ thống là?",
    hasImage: true,
    imgSrc: "images/3.4.jpg",
    options: [
        "1 router-LSA",
        "4 router-LSA",
        "1 network-LSA",
        "4 network-LSA"
    ],
    correct: [1, 2]
},

/* ================= OSPF – CẤU TRÚC GÓI TIN ================= */

{
    question: "Trong hệ thống OSPF, router sử dụng thành phần nào trong gói tin OSPF để trao đổi thông tin trạng thái kết nối?",
    options: [
        "OSPF header",
        "OSPF advertisement",
        "Router Link State Advertisement",
        "Network Link State Advertisement",
        "Single Area Advertisement"
    ],
    correct: [2, 3]
}

];


    let currentQ = 0;
    let score = 0;
    let selectedAnswers = null; 

    const qNum = document.getElementById('q-number');
    const qType = document.getElementById('q-type');
    const qText = document.getElementById('q-text');
    const imgContainer = document.getElementById('q-img-container');
    const imgEl = document.getElementById('q-img');
    const optionsGrid = document.getElementById('options-grid');
    const explanationEl = document.getElementById('explanation');
    const submitBtn = document.getElementById('submit-btn');
    const nextBtn = document.getElementById('next-btn');
    const progressFill = document.getElementById('progress-fill');
    const restartBtn = document.getElementById('restart-btn');

    // --- 1. HÀM XÁO TRỘN CÂU HỎI (MỚI) ---
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    // --- 2. HÀM KHỞI TẠO BÀI THI (MỚI) ---
    function initQuiz() {
        shuffleArray(quizData); // Đảo câu hỏi
        currentQ = 0;
        score = 0;
        
        // Reset giao diện
        document.getElementById('quiz-area').classList.remove('hide');
        document.getElementById('controls').classList.remove('hide');
        document.getElementById('header').classList.remove('hide');
        document.getElementById('score-area').classList.add('hide');

        loadQuestion();
    }

    function loadQuestion() {
        const q = quizData[currentQ];
        const isMulti = Array.isArray(q.correct);

        qNum.innerText = `Câu hỏi ${currentQ + 1} / ${quizData.length}`;
        qType.innerText = isMulti ? '(Chọn nhiều đáp án)' : '(Chọn 1 đáp án)';
        qType.style.color = isMulti ? '#e11d48' : '#2563eb';

        qText.innerText = q.question;
        explanationEl.style.display = 'none';
        
        // Xử lý hình ảnh
        if (q.hasImage) {
            imgContainer.style.display = 'block';
            if (q.imgSrc) {
                imgEl.src = q.imgSrc;
            } else {
                imgEl.src = "https://via.placeholder.com/600x300?text=Chua+co+hinh+anh";
            }
        } else {
            imgContainer.style.display = 'none';
        }

        optionsGrid.innerHTML = '';
        optionsGrid.className = 'options-grid ' + (isMulti ? 'type-multi' : 'type-single');
        
        selectedAnswers = isMulti ? [] : null;
        submitBtn.disabled = true;
        submitBtn.classList.remove('hide');
        nextBtn.classList.add('hide');

        q.options.forEach((opt, idx) => {
            const el = document.createElement('div');
            el.className = 'option-item';
            el.innerHTML = `<div class="indicator"></div><div>${opt}</div>`;
            el.onclick = () => handleSelect(el, idx, isMulti);
            optionsGrid.appendChild(el);
        });

        updateProgress();
    }

    function handleSelect(el, idx, isMulti) {
        if (el.classList.contains('disabled')) return;

        if (isMulti) {
            el.classList.toggle('selected');
            const pos = selectedAnswers.indexOf(idx);
            if (pos === -1) selectedAnswers.push(idx);
            else selectedAnswers.splice(pos, 1);
            selectedAnswers.sort((a, b) => a - b);
            submitBtn.disabled = selectedAnswers.length === 0;
        } else {
            const all = optionsGrid.children;
            for (let child of all) child.classList.remove('selected');
            el.classList.add('selected');
            selectedAnswers = idx;
            submitBtn.disabled = false;
        }
    }

    submitBtn.onclick = () => {
        const q = quizData[currentQ];
        const isMulti = Array.isArray(q.correct);
        const allOpts = optionsGrid.children;
        let isCorrect = false;

        for (let child of allOpts) child.classList.add('disabled');

        if (isMulti) {
            const sortedCorrect = [...q.correct].sort((a, b) => a - b);
            const sortedSelected = [...selectedAnswers].sort((a, b) => a - b);
            isCorrect = JSON.stringify(sortedCorrect) === JSON.stringify(sortedSelected);

            for (let i = 0; i < allOpts.length; i++) {
                if (q.correct.includes(i)) {
                    if (selectedAnswers.includes(i)) allOpts[i].classList.add('correct');
                    else allOpts[i].classList.add('missed');
                } else {
                    if (selectedAnswers.includes(i)) allOpts[i].classList.add('wrong');
                }
            }
        } else {
            isCorrect = (selectedAnswers === q.correct);
            if (isCorrect) {
                allOpts[selectedAnswers].classList.add('correct');
            } else {
                allOpts[selectedAnswers].classList.add('wrong');
                allOpts[q.correct].classList.add('correct');
            }
        }

        if (isCorrect) score++;

        if (q.note) {
            explanationEl.innerHTML = `<strong>Giải thích:</strong> ${q.note}`;
            explanationEl.style.display = 'block';
        }

        submitBtn.classList.add('hide');
        nextBtn.classList.remove('hide');
    };

    nextBtn.onclick = () => {
        currentQ++;
        if (currentQ < quizData.length) loadQuestion();
        else showResult();
    };

    function updateProgress() {
        const pct = (currentQ / quizData.length) * 100;
        progressFill.style.width = `${pct}%`;
    }

    function showResult() {
        document.getElementById('quiz-area').classList.add('hide');
        document.getElementById('controls').classList.add('hide');
        document.getElementById('header').classList.add('hide');
        document.getElementById('score-area').classList.remove('hide');
        
        const finalScoreEl = document.getElementById('final-score');
        finalScoreEl.innerText = `${score}/${quizData.length}`;
        
        const pct = (score / quizData.length) * 100;
        const circle = document.querySelector('.score-circle');
        circle.style.background = `conic-gradient(var(--success) ${pct}%, #e2e8f0 0)`;

        const msg = document.getElementById('score-msg');
        if (pct >= 80) msg.innerText = "Xuất sắc! Bạn nắm rất vững kiến thức.";
        else if (pct >= 50) msg.innerText = "Khá tốt! Hãy ôn lại các câu sai nhé.";
        else msg.innerText = "Cần cố gắng thêm!";
    }

    // --- 3. GÁN SỰ KIỆN CHO NÚT LÀM LẠI ---
    restartBtn.onclick = () => {
        initQuiz();
    };

    // --- BẮT ĐẦU ---
    initQuiz(); // Thay vì gọi loadQuestion(), ta gọi initQuiz()
</script>

</body>
</html>